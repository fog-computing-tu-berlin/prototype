# Problems with Alpine due to GCC
FROM python:3.6

# TODO non root user
COPY requirements.txt /src/
WORKDIR /src

RUN pip install --no-cache-dir  -r requirements.txt

COPY src /src/

EXPOSE 5555/tcp
EXPOSE 5556/tcp
EXPOSE 5557/tcp

ENV IS_DEBUG_LOGGING 'True'
ENV CONTROL_MESSAGE_TICK_RATE 4
ENV CONTROL_MESSAGE_TICKER_UPDATE_TIMEOUT 300000
ENV EDGE_RECEIVER_LISTEN_PORT 5555
ENV EDGE_CONTROLLER_PORT 5556
ENV EDGE_ID_GENERATOR_LISTEN_PORT 5557
ENV CLOUD_UPLOAD_URL 'tcp://cloud:5558'
ENV EDGE_ID_UPSTREAM_URL 'tcp://cloud:5559'
ENV EDGE_RECEIVER_MAX_QUEUE_LENGTH 10000
ENV EDGE_ID_RELAY_MAX_QUEUE_LENGTH 10000
ENV INTERNAL_MESSAGE_CACHE_MAX_QUEUE_LENGTH 100000
ENV CLOUD_SUBMIT_TIMEOUT 60000
ENV CLOUD_ID_RELAY_CLOUD_TIMEOUT 5000
ENV WEATHER_LIMIT_HOURS_IN_FUTURE 6
ENV WEATHER_FORCE_ALWAYS_WATER_RETURN_VALUE -1
ENV WEATHER_FORCE_ALWAYS_LIGHT_RETURN_VALUE -1
ENV WEATHER_CITY 'Berlin'

CMD python /src/index.py