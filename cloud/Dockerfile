# Problems with Alpine due to GCC
FROM python:3.6

# TODO non root user
COPY requirements.txt /src/
WORKDIR /src

RUN pip install --no-cache-dir  -r requirements.txt

COPY src /src/

EXPOSE 5000/tcp
EXPOSE 5555/tcp

ENV IS_DEBUG_LOGGING 'True'
ENV DATABASE_REST_URL 'http://postgrest:3000/'
ENV FOG_RECEIVER_LISTEN_PORT 5558
ENV ID_FOG_RECEIVER_LISTEN_PORT 5559
ENV FOG_RECEIVER_MAX_QUEUE_LENGTH 10000
ENV ID_RECEIVER_MAX_QUEUE_LENGTH 10000
ENV INTERNAL_MESSAGE_CACHE_MAX_QUEUE_LENGTH 100000

CMD python /src/index.py